# 代码解决助手 - 更新日志

## v2.0 - 2024-10-28

### 新增功能

1. **自动清理 Markdown 格式**
   - 移除代码块标记（`` ` ``）
   - 移除粗体和斜体标记（`**`、`*`）
   - 移除标题标记（`#`）
   - 移除链接和图片格式
   - 清理多余空行

2. **智能分段发送**
   - 自动分离"问题分析"和"代码解决方案"
   - 先发送问题分析部分
   - 然后依次发送各个代码方案
   - 支持检测多个代码块（C/C++、Python、Java 等）

3. **长代码自动分割**
   - 超过 2000 字符的代码自动分割成多条消息
   - 按行智能分割，保持代码完整性
   - 自动识别语言类型

4. **多次消息发送**
   - 第1条消息：问题分析
   - 第2-N条消息：代码解决方案（可按语言分类）
   - 每次发送之间自动延迟，避免消息过快

### 配置调整

- `max_tokens` 从 4000 增加到 10000，确保代码完整输出
- 添加超时保护（60秒）
- 优化代码语言检测算法

### 使用示例

```
用户：/代码 给定n，m求【n，m】区间的排序问题，如果是素数就从小到大输出

机器人：
[第1条] 问题分析：
这是一个区间排序问题，需要判断每个数字是否为素数...

[第2条] 【C/C++代码方案】

#include <iostream>
...

[第3条] 【Python代码方案】

def is_prime(n):
...
```

### 技术改进

- 使用 `clean_markdown()` 函数清理格式符号
- 使用 `send_split_messages()` 智能分段
- 使用 `detect_language()` 自动识别编程语言
- 使用 `send_long_code()` 处理超长代码

### 注意事项

- 确保设置了 `SILICONFLOW_API_KEY` 环境变量
- 网络不稳定时可能会有延迟
- 代码过长时会自动分割发送

# 代码解决助手 (solvecode)

专业的代码问题解决方案生成插件，使用硅基流动的 DeepSeek-V3.2-Exp 模型。

## 功能特性

- 🎯 **智能拦截**：使用高优先级拦截 `/代码` 开头的消息，阻止与其他插件冲突
- 🧠 **AI 驱动**：使用 DeepSeek-V3.2-Exp 模型进行代码分析和生成
- 📋 **结构化回复**：自动格式化为"问题分析"和"代码及解决方案"两部分
- ⚡ **快速响应**：优化 API 调用，确保完整代码输出

## 使用方法

发送以下格式的消息即可使用：

```
/代码 <问题描述>
```

### 示例

```
/代码 给定n，m求【n，m】区间的排序问题，如果是素数就从小到大输出，如果不是素数就从大到小输出
```

## 回复格式

插件会自动将回复格式化为两段：

1. **问题分析**：说明问题的核心思路和解决方向
2. **代码及解决方案**：提供完整可运行的代码和详细解释

## 配置要求

### 环境变量

需要在 `.env` 文件中或系统环境变量中设置：

```bash
SILICONFLOW_API_KEY=your_api_key_here
```

### API 配置

- **API 提供商**：硅基流动 (SiliconFlow)
- **使用模型**：`deepseek-ai/DeepSeek-V3.2-Exp`
- **最大 tokens**：4000（确保代码完整）
- **超时时间**：60秒

## 工作原理

1. **消息拦截**：使用 `priority=20, block=True` 确保优先处理
2. **命令识别**：检测 `/代码` 开头的消息
3. **API 调用**：向硅基流动 API 发送请求
4. **智能格式化**：自动检测并格式化响应为两部分
5. **内容完整性**：确保代码和解决方案完整输出

## 注意事项

- 此插件与 deepseek 聊天插件互斥
- 触发 `/代码` 命令后，不会调用原有的对话回复机制
- 如果 API 调用失败，会返回友好的错误提示
- 建议在问题描述中尽可能详细，有助于生成更好的解决方案

## 常见问题

### Q: 如何获取硅基流动 API 密钥？
A: 访问 [SiliconFlow](https://www.siliconflow.cn/) 注册账号并获取 API 密钥。

### Q: 为什么没有收到回复？
A: 检查以下几点：
1. 环境变量 `SILICONFLOW_API_KEY` 是否已设置
2. API 密钥是否有效
3. 网络连接是否正常

### Q: 生成的代码不完整？
A: 将 `max_tokens` 设置为 4000，如果问题很复杂，可以考虑增加这个值。

## 日志

插件会输出详细的日志信息：

```
[solvecode] 收到代码问题 - 用户 xxx: ...
[solvecode] API调用成功，生成了 xxx 字符的回复
[solvecode] 已成功回复代码问题 - 用户 xxx
```

## 开发说明

### 文件结构

```
solvecode/
├── __init__.py    # 主插件文件
└── README.md      # 本文档
```

### 技术栈

- **框架**：NoneBot2
- **HTTP 客户端**：httpx
- **API 提供商**：SiliconFlow
- **模型**：DeepSeek-V3.2-Exp

### 代码改进建议

1. 支持多轮对话上下文
2. 添加代码格式支持（markdown）
3. 支持多种编程语言
4. 添加代码执行验证功能
